<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/mvp.css">
    <title>SVG Converter</title>
</head>
<body onload="convertSvgs()">
<h1>Convert</h1>
<object data="SVG%20Editor.svg"></object>
<script>

    function intersectRect(reference, subject) {
        reference = reference.getBoundingClientRect();
        subject = subject.getBoundingClientRect();
        return reference.left <= subject.left && reference.right >= subject.right &&
            reference.top <= subject.top && reference.bottom >= subject.bottom;

    }

    function convertSvgs() {
        const obj = document.querySelector('object').contentDocument
        Array.from(obj.querySelectorAll('a')).forEach(link => {
            link.setAttribute("target", "_top");
            link.setAttribute("xlink:href", link.getAttribute("xlink:href").replace('https://www.google.com/url?q=', ''))
            link.setAttribute("xlink:href", link.getAttribute("xlink:href").replace(/http.*\/deliveryhub\//, '/deliveryhub/'))
            Array.from(link.children).forEach(clickableZone => {
                const collisions = Array.from(obj.querySelectorAll('*')).filter(svgElement => intersectRect(clickableZone, svgElement));
                collisions.forEach(svgElement => {
                    if (svgElement !== link) {
                        link.appendChild(svgElement)
                    }
                })
            })
        });
    }

</script>
</body>
</html>
